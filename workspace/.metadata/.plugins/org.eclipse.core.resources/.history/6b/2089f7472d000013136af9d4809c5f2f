package viewController;

import java.awt.Color;
import java.awt.Component;
import java.io.IOException;
import java.util.ArrayList;

import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLayeredPane;
import javax.swing.JMenuItem;
import javax.swing.JTable;
import javax.swing.table.TableCellRenderer;

import org.math.plot.Plot2DPanel;

public class PeakFrame extends JFrame{
	private void initComponents() {

    	peakTabbedPane = new javax.swing.JTabbedPane();
    	chromPlot = new Plot2DPanel();
    	specPlot = new Plot2DPanel();
    	relatedPlot = new Plot2DPanel();
    	
    	setExtendedState(getExtendedState() | JFrame.MAXIMIZED_BOTH);
        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        
        chromPlot.setAxisLabels("RT", "Intensity");
		chromPlot.addLegend("EAST");
		chromPlot.removePlotToolBar();
		peakTabbedPane.addTab("Chromatogram",chromPlot);
		
		specPlot.setAxisLabels("m/z", "Intensity");
		specPlot.addLegend("EAST");
		specPlot.removePlotToolBar();
		peakTabbedPane.addTab("Mass Spectrum", specPlot);
		
		relatedPlot.setAxisLabels("RT", "Intensity");
		relatedPlot.addLegend("EAST");
		relatedPlot.removePlotToolBar();
		peakTabbedPane.addTab("Related Peaks", relatedPlot);
		
		add(peakTabbedPane);
		
		updateButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
        		int[] selected = infoTable.getSelectedRows();
                updateActionPerformed(selected);
            }
		});
		
		menuBar.add(fileMenu);
		JMenuItem openPeakMLItem = new JMenuItem("Open PeakML File");
		openPeakMLItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
            	chromPlot.removeAllPlots();
        		specPlot.removeAllPlots();
        		relatedPlot.removeAllPlots();
            	boolean success = openPeakMLItemActionPerformed(evt);
            	if (success){
	            	String[] columnNames = {"Mass",
	                        "Intensity",
	                        "Retention Time",
	                        "Link"};
//	                        "relation.ship",
//	                        "Relation ID"};
	            	infoTable.setModel(new javax.swing.table.DefaultTableModel(updateTable(), columnNames));
            	}
            }
		});
		fileMenu.add(openPeakMLItem);
		JMenuItem openIdentificationItem = new JMenuItem("Open Identification File");
		openIdentificationItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
            	boolean success = openIdentificationItemActionPerformed(evt);
            	if (success){
//        			String pathID = "ko01100";
            		String pathID = "tbr01100";
            		try {
						getImg(pathID);
						getLinks(pathID);
						addPopupMenus();
//						System.out.println(relatedGroups.size());
					} catch (IOException e) {
						System.out.println("Image loading failed.");
					}
//        			frame.validate();
//        			frame.repaint();
//        		    frame.setVisible(true);
            	}
            }
		});
		fileMenu.add(openIdentificationItem);
		JMenuItem exitMenuItem = new JMenuItem("Exit");
		exitMenuItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
            	System.exit(0);
            }
		});
		fileMenu.add(exitMenuItem);
		
		regButtons = new ArrayList<JButton>();
	    buttonDetails = new ArrayList<properIdent>();
	    relatedGroups = new ArrayList<ArrayList<Integer>>();
	    
	    prevGroup = -1;
	    prevButton = -1;
	    
	    relatedLabel = new TransparentLabel("");
	    relatedLabel.setBackground(Color.BLUE);
		
		linkPanel = new ImagePanel();
	    linkPanel.setLayout(null);
	    linkPanel.setOpaque(false);
	    
		linkPanel.add(relatedLabel, JLayeredPane.DEFAULT_LAYER);
	    mainTabbedPane.addTab("Pathway", linkPanel);
		
        pack();
    }
}
